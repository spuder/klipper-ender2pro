---
- name: Update klipper config
  hosts: ender2pro
  remote_user: root
  gather_facts: no

  tasks:
  - name: Copy printer.cfg to printer
    ansible.builtin.copy:
      src: ./printer.cfg
      dest: /home/pi/klipper_config/printer.cfg
      owner: pi
      group: pi
    register: printer_config

  - name: Copy webcam.txt to printer
    ansible.builtin.copy:
      src: ./webcam.txt
      dest: /home/pi/klipper_config/webcam.txt
      owner: pi
      group: pi
    register: webcam_config

  - name: Copy macros.cfg to printer
    ansible.builtin.copy:
      src: ./macros.cfg
      dest: /home/pi/klipper_config/macros.cfg
      owner: pi
      group: pi
    register: macros_config

  - name: Klipper Service
    service:
      name: klipper
      state: restarted
    when: 
    - printer_config.changed or macros_config.changed

  - name: Webcamd Service
    service:
      name: webcamd
      state: restarted
    when: 
    - webcam_config.changed
